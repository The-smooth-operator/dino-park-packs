openapi: 3.0.0
info:
  description: Mozilla's IAM group API
  version: 1.0.0-oas3
  title: Groups
  contact:
    email: fiji@mozilla.com
  license:
    name: MPL 2.0
    url: https://www.mozilla.org/media/MPL/2.0/index.txt
paths:
  "/groups/api/v1/groups":
    post:
      summary: creates a group
      operationId: addGroup
      description: creates a new acces group
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NewGroup"
        description: Inventory item to add
      responses:
        "201":
          description: group created
        "400":
          description: invalid input, object invalid
        "409":
          description: an existing group already exists
  "/groups/api/v1/groups/{groupName}":
    get:
      summary: group information
      operationId: viewGroup
      description: |
        Retrieve information about a given group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      responses:
        "200":
          description: the group information requested
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Group"
        "406":
          description: not acceptable
    put:
      summary: updates a group
      description: |
        Update information and settings for a given group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GroupUpdate"
        description: Updates for a existing group
      responses:
        "201":
          description: updates applied
        "406":
          description: not acceptable
    delete:
      summary: deletes a group
      description: |
        Deletes a group and all related data
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      responses:
        "201":
          description: group deleted
        "406":
          description: not acceptable
  "/groups/api/v1/groups/{groupName}/details":
    get:
      summary: detailed group information
      description: Detailed information for group view
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      responses:
        "200":
          description: a page of members
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroupDetails"
  "/groups/api/v1/terms/{groupName}":
    get:
      summary: group terms
      description: get the terms of condition for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      responses:
        "200":
          description: text of the groups terms in markdown
          content:
            application/json:
              schema:
                type: string
                example: some terms
        "406":
          description: not acceptable
    delete:
      summary: delete group terms
      description: delete the terms of condition for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      responses:
        "201":
          description: terms deleted
        "406":
          description: not acceptable
    post:
      summary: create group terms
      description: create terms of condition for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
                  example: some terms
      responses:
        "201":
          description: terms created
        "406":
          description: not acceptable
    put:
      summary: update group terms
      description: update terms of condition for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
                  example: some terms
      responses:
        "201":
          description: terms updated
        "406":
          description: not acceptable
  "/groups/api/v1/invitations/{groupName}":
    get:
      summary: group invitations
      description: get invitations for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      responses:
        "200":
          description: list of invitations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Invitation"
        "406":
          description: not acceptable
    post:
      summary: invite a member
      description: invite a member to a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user_uuid:
                  type: string
                  format: uuid
                  example: 34a33a8e-d035-4051-acac-497a79235e73
                invitation_expiration:
                  description: expiration period in days
                  type: integer
                  example: 5
                group_expiration:
                  description: expiration period in days
                  type: integer
                  example: 180
      responses:
        "201":
          description: member invited
        "406":
          description: not acceptable
  "/groups/api/v1/invitations/{groupName}/{userUuid}":
    put:
      summary: update an invitation
      description: update inviation of a user
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: path
          name: userUuid
          description: user uuid of invitation to update
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                invitation_expiration:
                  description: expiration period in days
                  type: integer
                  example: 5
                group_expiration:
                  description: expiration period in days
                  type: integer
                  example: 180
      responses:
        "201":
          description: invitation updated
        "406":
          description: not acceptable
    delete:
      summary: delete an invitation
      description: delete an invitation for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: path
          name: userUuid
          description: user uuid of invitation to delete
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "201":
          description: invitation deleted
        "406":
          description: not acceptable
  "/groups/api/v1/members/{groupName}/{memberUuid}/renew":
    post:
      summary: renew a member
      description: renew a member for a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: path
          name: memberUuid
          description: pass in the uuid of the member to renew
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                group_expiration:
                  description: expiration period in days
                  type: integer
                  example: 180
      responses:
        "201":
          description: member added
        "406":
          description: not acceptable
  "/groups/api/v1/members/{groupName}/{memberUuid}":
    delete:
      summary: delete a member
      description: delete a member of a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: path
          name: memberUuid
          description: pass in the uuid of the member to delete
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "201":
          description: member deleted
        "406":
          description: not acceptable
    post:
      summary: add a member
      description: add a member to a group (admins only)
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: path
          name: memberUuid
          description: pass in the uuid of the member to add
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                group_expiration:
                  description: expiration period in days
                  type: integer
                  example: 180
      responses:
        "201":
          description: member added
        "406":
          description: not acceptable
  "/groups/api/v1/members/{groupName}":
    get:
      summary: paginated members
      description: |
        get paginated members of a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: query
          name: r
          description: filter results based on role
          required: false
          schema:
            type: string
            enum: [Any, Member, Curator]
        - in: query
          name: q
          description: search query to filter results
          required: false
          schema:
            type: string
      responses:
        "200":
          description: a page of members
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: "#/components/schemas/DisplayMember"
                  next:
                    type: integer
                    example: 20
  "/groups/api/v1/curators/{groupName}":
    post:
      summary: add a curator
      description: add a curator to a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - member_uuid
              properties:
                member_uuid:
                  type: string
                  format: uuid
                  example: 34a33a8e-d035-4051-acac-497a79235e73
      responses:
        "201":
          description: curator added
        "406":
          description: not acceptable
  "/groups/api/v1/curators/{groupName}/{memberUuid}/downgrade":
    post:
      summary: downgrade a curator to a normal member
      description: downgrade a curator to a normal member
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: path
          name: memberUuid
          description: pass in the uuid of the curator to downgrade
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                group_expiration:
                  type: integer
                  example: 90
                  description: group expiration for membership
      responses:
        "201":
          description: curator deleted
        "406":
          description: not acceptable
  "/groups/api/v1/users":
    get:
      summary: search for users
      description: |
        get top matches of users
      parameters:
        - in: query
          name: q
          description: search query to filter results
          required: true
          schema:
            type: string
          example: Han
        - in: query
          name: t
          description: trust filter for results
          required: false
          schema:
            $ref: "#/components/schemas/TrustType"
          example: Ndaed
      responses:
        "200":
          description: the top matches of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
  "/groups/api/v1/self/{groupName}":
    delete:
      summary: leave a group
      description: leave a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
        - in: query
          name: force
          description: force leaving the group
          required: false
          schema:
            type: boolean
      responses:
        "201":
          description: left group
        "406":
          description: not acceptable
  "/groups/api/v1/self/invitations":
    get:
      summary: inviations for the logged in user
      description: get all invitations for the logged in user
      responses:
        "200":
          description: list of inviatations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MyInvitation"
  "/groups/api/v1/self/join/{groupName}":
    post:
      summary: join a group
      description: join a group
      parameters:
        - in: path
          name: groupName
          description: pass in the group name to interact with
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        "200":
          description: joining status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [pending, joined]
                    example: joined
        "406":
          description: not acceptable
servers:
  - url: http://localhost:8085
components:
  schemas:
    Group:
      type: object
      required:
        - id
        - name
        - type
        - description
      properties:
        name:
          type: string
          example: dinopark-test
        type:
          type: string
          enum:
            - closed
            - reviewed
            - open
          example: closed
        description:
          type: string
          example: some fancy description in markdown
    GroupWithTerms:
      type: object
      required:
        - name
        - type
        - description
      properties:
        name:
          type: string
          example: dinopark-test
        type:
          type: string
          enum:
            - closed
            - reviewed
            - open
          example: closed
        description:
          type: string
          example: some fancy description in markdown
        terms:
          type: boolean
          example: true
    NewGroup:
      type: object
      required:
        - type
        - description
      properties:
        name:
          type: string
          example: dinos
        type:
          type: string
          enum:
            - closed
            - reviewed
            - open
          example: closed
        description:
          type: string
          example: some fancy description in markdown
        group_expiration:
          type: integer
          description: period in days after which a membership expires (0 for never)
          example: 90
    GroupUpdate:
      type: object
      properties:
        type:
          type: string
          enum:
            - closed
            - reviewed
            - open
          example: reviewed
        description:
          type: string
          example: another description in markdown
        group_expiration:
          type: integer
          description: period in days after which a membership expires (0 for never)
          example: 90
    TrustType:
      type: string
      enum: ["Public", "Authenticated", "Vouched", "Ndaed", "Staff"]
    User:
      type: object
      properties:
        user_uuid:
          type: string
          format: uuid
          example: 34a33a8e-d035-4051-acac-497a79235e73
        picture:
          type: string
          nullable: true
          example: https://picture.api.dev.sso.allizom.org/avatar/get/id/MzI0ZjAwMzA5Yzc1ZGYxYmIzYjdjMGE1NWZmMDc3OGY3NGJjYjAzMjc0NDVhZmI2YWViODBmMzIzOGNhYzM3NyNzdGFmZiMxNTcyODYyNzM3.png
        first_name:
          type: string
          nullable: true
          example: Hans
        last_name:
          type: string
          nullable: true
          example: Knall
        username:
          type: string
          example: hans
        email:
          type: string
          format: email
          nullable: true
          example: hans@knall.org
        trust:
          $ref:  "#/components/schemas/TrustType"
    DisplayMember:
      type: object
      properties:
        user_uuid:
          type: string
          format: uuid
          example: 34a33a8e-d035-4051-acac-497a79235e73
        picture:
          type: string
          nullable: true
          example: https://picture.api.dev.sso.allizom.org/avatar/get/id/MzI0ZjAwMzA5Yzc1ZGYxYmIzYjdjMGE1NWZmMDc3OGY3NGJjYjAzMjc0NDVhZmI2YWViODBmMzIzOGNhYzM3NyNzdGFmZiMxNTcyODYyNzM3.png
        name:
          type: string
          nullable: true
          example: Hans Knall
        username:
          type: string
          example: hans
        email:
          type: string
          format: email
          nullable: true
          example: hans@knall.org
        isStaff:
          type: boolean
          example: true
        since:
          type: string
          format: datetime
          nullable: true
          example: 2014-11-28T12:45:59Z
        expiration:
          type: string
          format: datetime
          nullable: true
          example: 2014-11-28T12:45:59Z
        role:
          type: string
          enum:
            - Admin
            - Curator
            - Member
        added_by:
          $ref: "#/components/schemas/AddedBy"
    MyInvitation:
      type: object
      properties:
        group_name:
          type: string
          example: dinos
        user_uuid:
          type: string
          format: uuid
          example: 34a33a8e-d035-4051-acac-497a79235e73
        invitation_expiration:
          type: string
          format: datetime
          nullable: true
          example: 2014-11-28T12:45:59Z
        group_expiration:
          type: integer
          nullable: true
          example: 90
          description: days after which membership will expire
        terms:
          type: boolean
          example: true
        added_by:
          $ref: "#/components/schemas/AddedBy"
    Invitation:
      type: object
      properties:
        user_uuid:
          type: string
          format: uuid
          example: 34a33a8e-d035-4051-acac-497a79235e73
        picture:
          type: string
          nullable: true
          example: https://picture.api.dev.sso.allizom.org/avatar/get/id/MzI0ZjAwMzA5Yzc1ZGYxYmIzYjdjMGE1NWZmMDc3OGY3NGJjYjAzMjc0NDVhZmI2YWViODBmMzIzOGNhYzM3NyNzdGFmZiMxNTcyODYyNzM3.png
        name:
          type: string
          nullable: true
          example: Hans Knall
        username:
          type: string
          example: hans
        email:
          type: string
          format: email
          nullable: true
          example: hans@knall.org
        isStaff:
          type: boolean
          example: true
        invitation_expiration:
          type: string
          format: datetime
          nullable: true
          example: 2014-11-28T12:45:59Z
        group_expiration:
          type: integer
          nullable: true
          example: 90
          description: days after which membership will expire
        added_by:
          $ref: "#/components/schemas/AddedBy"
    AddedBy:
      type: object
      properties:
        user_uuid:
          type: string
          example: 34a33a8e-d035-4051-acac-497a79235e73
        name:
          type: string
          nullable: true
          example: Hans Knall
        username:
          type: string
          nullable: true
          example: hans
        email:
          type: string
          format: email
          nullable: true
          example: hans@knall.org
    GroupDetails:
      type: object
      properties:
        curator:
          type: boolean
          example: true
        members:
          type: object
          properties:
            members:
              type: array
              items:
                $ref: "#/components/schemas/DisplayMember"
            next:
              type: integer
              nullable: true
              example: 20
        group:
          $ref: "#/components/schemas/GroupWithTerms"
        member_count:
          type: integer
          example: 50
        invitation_count:
          type: integer
          example: 2
        renewal_count:
          type: integer
          example: 3
